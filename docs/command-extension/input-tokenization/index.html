<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Botrino Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Botrino Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-45YBPVQ8K9","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-45YBPVQ8K9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-45YBPVQ8K9",{})</script><title data-react-helmet="true">Input tokenization | Botrino</title><meta data-react-helmet="true" property="og:url" content="https://botrino.alex1304.com/docs/command-extension/input-tokenization"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Input tokenization | Botrino"><meta data-react-helmet="true" name="description" content="As for the majority of command-based user interfaces, a command may accept some user input, often called &quot;arguments&quot;, to specify parameters for a specific action. The simplest commands can be run as-is, while more complex ones may require several arguments with some possibly being optional. Parsing the input, checking if required arguments are present, are of the correct format, etc can represent a lot of work when implementing such complex commands, and ends up being repetitive. The command extension of Botrino can do most of that boring work for you."><meta data-react-helmet="true" property="og:description" content="As for the majority of command-based user interfaces, a command may accept some user input, often called &quot;arguments&quot;, to specify parameters for a specific action. The simplest commands can be run as-is, while more complex ones may require several arguments with some possibly being optional. Parsing the input, checking if required arguments are present, are of the correct format, etc can represent a lot of work when implementing such complex commands, and ends up being repetitive. The command extension of Botrino can do most of that boring work for you."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://botrino.alex1304.com/docs/command-extension/input-tokenization"><link data-react-helmet="true" rel="alternate" href="https://botrino.alex1304.com/docs/command-extension/input-tokenization" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://botrino.alex1304.com/docs/command-extension/input-tokenization" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.aa6b4ed0.css">
<link rel="preload" href="/assets/js/runtime~main.b52fe0e6.js" as="script">
<link rel="preload" href="/assets/js/main.3ab302a1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Botrino Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Botrino Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Botrino</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Alex1304/botrino" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Botrino Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Botrino Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Botrino</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/Alex1304/botrino" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Discover Botrino</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Getting Started</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Framework API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/working-with-services">Working with services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/configuring-your-bot">Configuring your bot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/customizing-the-discord-client">Customizing the Discord client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/extensions">Extensions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/i18n">Internationalization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Interaction library</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/creating-commands">Creating commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/acknowledging-interactions">Acknowledging interactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/dealing-with-components">Dealing with components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/privileges">Privileges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/cooldowns">Cooldowns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/handling-errors">Handling errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interaction-library/filtering-and-adapting-events">Filtering and adapting events</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Command extension [Deprecated]</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/creating-commands">Creating commands</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/command-extension/input-tokenization">Input tokenization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/subcommands">Subcommands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/privileges">Privileges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/cooldowns">Cooldowns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/handling-errors">Handling errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/filtering-and-adapting-events">Filtering and adapting events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/documenting-commands">Documenting commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/command-extension/interactive-menus">Interactive menus</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Input tokenization</h1></header><div class="markdown"><p>As for the majority of command-based user interfaces, a command may accept some user input, often called &quot;arguments&quot;, to specify parameters for a specific action. The simplest commands can be run as-is, while more complex ones may require several arguments with some possibly being optional. Parsing the input, checking if required arguments are present, are of the correct format, etc can represent a lot of work when implementing such complex commands, and ends up being repetitive. The command extension of Botrino can do most of that boring work for you.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tokenization"></a>Tokenization<a class="hash-link" href="#tokenization" title="Direct link to heading">#</a></h2><p>When a message create event is received from Discord, the content of the message is interpreted in order to find the corresponding command. It will split the message content into &quot;words&quot;, stripping out the prefix, will match the first &quot;word&quot; with a command name and will process the remaining &quot;words&quot; into <strong>arguments</strong> and <strong>flags</strong>. This process is called <strong>input tokenization</strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="arguments"></a>Arguments<a class="hash-link" href="#arguments" title="Direct link to heading">#</a></h3><p>An argument is a substring of the message content that is delimited with whitespaces and that comes after the command name. A simple example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">!hello world</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here the command name is <code>hello</code>, and <code>world</code> is an argument.</p><p>You can access the list of arguments via <code>CommandContext.input().getArguments()</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">@Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">public Mono&lt;Void&gt; run(CommandContext ctx) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    List&lt;String&gt; args = ctx.input().getArguments();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    return ctx.channel().createMessage(args.toString()).then();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If this was the implementation of the previous example, it would send <code>[world]</code> in the Discord channel (the <code>toString()</code> representation of the <code>List</code> of arguments). Another example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">!hello foo bar</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>would reply with <code>[foo, bar]</code>, etc.</p><p>It is possible to put spaces into a single argument if it is delimited with double quotes (<code>&quot;</code>). As such, the example below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">!hello &quot;foo bar&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>would return a list of <strong>one</strong> element which is the string <code>foo bar</code>.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This implies that the double quote character is reserved and should be escaped with <code>\</code> if you want to use it in an argument value, same for the <code>\</code> character itself. See the table below that illustrates that.</p></div></div><table><thead><tr><th>input</th><th>output</th></tr></thead><tbody><tr><td><code>!hello &quot;foo bar&quot;</code></td><td><code>[foo bar]</code></td></tr><tr><td><code>!hello \&quot;foo bar\&quot;</code></td><td><code>[&quot;foo, bar&quot;]</code></td></tr><tr><td><code>!hello fo\\o ba\\r</code></td><td><code>[fo\o, ba\r]</code></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="flags"></a>Flags<a class="hash-link" href="#flags" title="Direct link to heading">#</a></h3><p>Flags are similar to arguments, except they are <strong>named</strong> and are <strong>position-independent</strong>. A flag is distinguished from an argument by a dash (<code>-</code>) prefix.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">!hello -a world</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In the example above, there is <strong>only one</strong> argument, <code>world</code>. Indeed, <code>-a</code> isn&#x27;t an argument but a <strong>flag</strong>, due to the presence of the <code>-</code> prefix. In the code of the command, you can access a flag like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">@Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">public Mono&lt;Void&gt; run(CommandContext ctx) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    String message;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    if (ctx.input().getFlag(&quot;a&quot;).isPresent()) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        message = &quot;The flag is present&quot;;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        message = &quot;The flag isn&#x27;t present&quot;;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    return ctx.channel().createMessage(message).then();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You must not write the <code>-</code> prefix in the argument of <code>getFlag()</code>. It returns an <code>Optional&lt;String&gt;</code> that is empty if the flag is not present in the message. The position-independent nature of flags implies that <code>!hello -a world</code> and <code>!hello world -a</code> are strictly equivalent. Even something like <code>!-a hello world</code> will work. If the flag is present, it will return an empty <code>String</code>, unless a specific value is passed like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">!hello -a=foo world</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this case, <code>getFlag(&quot;a&quot;)</code> would return an <code>Optional</code> containing the string <code>foo</code>. Here is a table to summarize:</p><table><thead><tr><th>input</th><th>result of <code>ctx.input().getFlag(&quot;a&quot;)</code></th></tr></thead><tbody><tr><td><code>!hello</code></td><td><code>Optional.empty()</code></td></tr><tr><td><code>!hello -a</code></td><td><code>Optional.of(&quot;&quot;)</code></td></tr><tr><td><code>!hello -a=foo</code></td><td><code>Optional.of(&quot;foo&quot;)</code></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="grammar"></a>Grammar<a class="hash-link" href="#grammar" title="Direct link to heading">#</a></h2><p>The fact that tokenization is done for you is a great thing, but that&#x27;s only a part of the work. When you access the value of an argument, you still need to interpret it, and possibly do some type conversion and validation work on it.</p><p>Let&#x27;s take a simple example. You want to create a command that allows to rename a channel in a guild. The most intuitive way to design the command is to do something like <code>!rename &lt;channel&gt; &lt;new_name&gt;</code>. The second argument is just a string so it won&#x27;t be too much of an issue, however the first argument must be interpreted as an existing Discord channel in the current guild first.</p><p>With what you know already, you can implement that command as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">package com.example.myproject;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.api.util.DiscordParser;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.api.util.MatcherFunction;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.Command;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.CommandContext;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.CommandFailedException;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.Scope;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.annotation.Alias;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.annotation.TopLevelCommand;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import discord4j.core.object.entity.channel.*;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import reactor.core.publisher.Mono;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@Alias(&quot;rename&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@TopLevelCommand</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">public final class RenameCommand implements Command {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    public Mono&lt;Void&gt; run(CommandContext ctx) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        var args = ctx.input().getArguments();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        if (args.size() &lt; 2) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            return Mono.error(new CommandFailedException(&quot;Expected 2 arguments&quot;));</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        var gateway = ctx.event().getClient();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        var guildId = ctx.event().getGuildId().orElseThrow(); // Never throws because we set Scope.GUILD_ONLY</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        var channelMono = DiscordParser.parseGuildChannel(gateway, guildId, args.get(0));</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        var newName = args.get(1);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        return channelMono</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .flatMap(channel -&gt; MatcherFunction.&lt;Mono&lt;? extends GuildChannel&gt;&gt;create()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(TextChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(NewsChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(StoreChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(VoiceChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .apply(channel)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .orElseGet(() -&gt; Mono.error(new CommandFailedException(&quot;Unknown channel type&quot;))))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .then(ctx.channel().createMessage(&quot;Successfully renamed channel&quot;))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .then();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    public Scope scope() {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        return Scope.GUILD_ONLY;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Since this example is simple enough, the <code>run</code> method is only 18 lines long, so it&#x27;s not that bad. But you can notice that 8 of those lines only consist of parsing the arguments, the core logic of the method resides in the last 10 lines. You can imagine for more complex commands with many arguments that the first part can be heavy and repetitive. This is the problematic <strong>command grammars</strong> bring a solution to.</p><p>With a grammar, you can completely get rid of the code that handles arguments, so that your <code>run</code> method is effectively focused on its core logic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">package com.example.myproject;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.api.util.MatcherFunction;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.Command;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.CommandContext;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.CommandFailedException;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.Scope;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.annotation.Alias;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.annotation.TopLevelCommand;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.grammar.ArgumentMapper;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import botrino.command.grammar.CommandGrammar;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import discord4j.core.object.entity.channel.*;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">import reactor.core.publisher.Mono;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@Alias(&quot;rename&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">@TopLevelCommand</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">public final class RenameCommand implements Command {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private final CommandGrammar&lt;Args&gt; grammar = CommandGrammar.builder() // Step 2</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            .nextArgument(&quot;channel&quot;, ArgumentMapper.asGuildChannel())</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            .nextArgument(&quot;newName&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">            .build(Args.class);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    public Mono&lt;Void&gt; run(CommandContext ctx) {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        return grammar.resolve(ctx) // Step 3</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .flatMap(args -&gt; MatcherFunction.&lt;Mono&lt;? extends GuildChannel&gt;&gt;create()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(TextChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(args.newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(NewsChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(args.newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(StoreChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(args.newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .matchType(VoiceChannel.class, ch -&gt; ch.edit(spec -&gt; spec.setName(args.newName)))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .apply(args.channel)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                        .orElseGet(() -&gt; Mono.error(new CommandFailedException(&quot;Unknown channel type&quot;))))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .then(ctx.channel().createMessage(&quot;Successfully renamed channel&quot;))</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">                .then();</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    public Scope scope() {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        return Scope.GUILD_ONLY;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private static final class Args { // Step 1</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        private GuildChannel channel;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        private String newName;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Creating a grammar is done in 3 steps:</p><ol><li>Declare an <strong>internal class</strong> with fields corresponding to arguments with their correct type.</li><li>Build a <code>CommandGrammar</code> instance describing the sequence of arguments accepted by your command. The <code>nextArgument</code> method allows you to specify the name of the field of the internal class to bind, with an <code>ArgumentMapper</code> if the target type is something else than <code>String</code>. Think of <code>ArgumentMapper</code> like a <code>BiFunction&lt;CommandContext, String, T&gt;</code> where <code>T</code> is the target type. The most common types are present as a static factory in <code>ArgumentMapper</code>, but you can implement your own with a lambda expression. The order in which <code>nextArgument</code> calls are made is important as it will determine if the command should be <code>!rename &lt;channel&gt; &lt;newName&gt;</code> or <code>!rename &lt;newName&gt; &lt;channel&gt;</code>.</li><li>In your <code>run</code> method, all you need to do is to call <code>grammar.resolve(CommandContext)</code> to get an instance of your internal class with all arguments filled. In this case it will automatically emit <code>InvalidSyntaxException</code> if the arguments are missing, because all arguments are required by default.</li></ol><p>The <code>CommandGrammar.Builder</code> class has additional features allowing you to configure <strong>optional</strong> and <strong>varying</strong> arguments:</p><div class="codeBlockContainer_K1bP"><div style="color:#9CDCFE;background-color:#1E1E1E" class="codeBlockTitle_eoMF">Example 1: foo is required, bar is optional</div><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">CommandGrammar.builder()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;foo&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .beginOptionalArguments()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;bar&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .build(Args.class);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">private static final class Args {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private String foo; // Cannot be null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private String bar; // Can be null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#9CDCFE;background-color:#1E1E1E" class="codeBlockTitle_eoMF">Example 2: both foo and bar are optional</div><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">CommandGrammar.builder()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .beginOptionalArguments()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;foo&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;bar&quot;, ArgumentMapper.asInteger())</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .build(Args.class);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">private static final class Args {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private String foo; // Can be null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private Integer bar; // Can be null, so must be of type Integer (and not int)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#9CDCFE;background-color:#1E1E1E" class="codeBlockTitle_eoMF">Example 3: bar can be repeated zero, one or multiple times</div><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">CommandGrammar.builder()</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;foo&quot;)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .nextArgument(&quot;bar&quot;, ArgumentMapper.asInteger())</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .setVarargs(true)</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">        .build(Args.class);</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">private static final class Args {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private String foo; // Cannot be null</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    private List&lt;Integer&gt; bar; // Must be a List of the target type, can be empty</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A few things to note:</p><ul><li>If an optional argument is not provided, the corresponding field in the internal class will be filled with <code>null</code>. It means that for primitive types you need to use the wrapper type for the field type (<code>java.lang.Integer</code> for <code>int</code>, etc) otherwise you will experience <code>NullPointerException</code>.</li><li>Optional arguments can only be at the end, hence <code>beginOptionalArguments()</code> which separates required from optional arguments.</li><li><code>setVarargs(true)</code> is the only method that is insensitive to its position in the chain: it only applies to the very last argument.</li><li>A varying argument is materialized with a field of type <code>java.util.List</code> in the internal class, and is always optional even if <code>beginOptionalArguments()</code> was never called (in which case the list will be empty).</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The Command Grammar API does not support flags at this moment, only regular arguments. Feel free to suggest it or open a PR in the <a href="https://github.com/Alex1304/botrino" target="_blank" rel="noopener noreferrer">GitHub repository</a> if you have improvement ideas.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Alex1304/botrino/edit/main/website/docs/command-extension/input-tokenization.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/command-extension/creating-commands"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Creating commands</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/command-extension/subcommands"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Subcommands Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tokenization" class="table-of-contents__link">Tokenization</a><ul><li><a href="#arguments" class="table-of-contents__link">Arguments</a></li><li><a href="#flags" class="table-of-contents__link">Flags</a></li></ul></li><li><a href="#grammar" class="table-of-contents__link">Grammar</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Alex1304/botrino" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Alexandre Miranda (Alex1304). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b52fe0e6.js"></script>
<script src="/assets/js/main.3ab302a1.js"></script>
</body>
</html>