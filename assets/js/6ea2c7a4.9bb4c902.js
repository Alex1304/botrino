"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[36],{7732(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>s});const r=JSON.parse('{"id":"interaction-library/handling-errors","title":"Handling errors","description":"The execution of a interaction may fail for many reasons. You can handle these errors in a way that is adapted to each","source":"@site/docs/interaction-library/handling-errors.mdx","sourceDirName":"interaction-library","slug":"/interaction-library/handling-errors","permalink":"/docs/interaction-library/handling-errors","draft":false,"unlisted":false,"editUrl":"https://github.com/Alex1304/botrino/edit/main/website/docs/interaction-library/handling-errors.mdx","tags":[],"version":"current","frontMatter":{"title":"Handling errors"},"sidebar":"someSidebar","previous":{"title":"Cooldowns","permalink":"/docs/interaction-library/cooldowns"},"next":{"title":"Filtering and adapting events","permalink":"/docs/interaction-library/filtering-and-adapting-events"}}');var o=t(4848),i=t(8453);const a={title:"Handling errors"},l=void 0,c={},s=[{value:"Global error handler",id:"global-error-handler",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The execution of a interaction may fail for many reasons. You can handle these errors in a way that is adapted to each\ntype of errors, this is done via the ",(0,o.jsx)(n.code,{children:"InteractionErrorHandler"})," interface."]}),"\n",(0,o.jsx)(n.h2,{id:"global-error-handler",children:"Global error handler"}),"\n",(0,o.jsxs)(n.p,{children:["You simply need to create a class implementing ",(0,o.jsx)(n.code,{children:"InteractionErrorHandler"}),". If you are using the Botrino framework, it\nwill automatically be set into the interaction service. Otherwise, you need to set it via the builder when constructing\nyour ",(0,o.jsx)(n.code,{children:"InteractionService"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"final var interactionService = InteractionService.builder(config, gateway)\n        .setErrorHandler(new MyErrorHandler())\n        .build();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Here is an example of ",(0,o.jsx)(n.code,{children:"InteractionErrorHandler"})," implementation:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'package testbot1;\n\nimport botrino.api.util.DurationUtils;\nimport botrino.interaction.InteractionErrorHandler;\nimport botrino.interaction.InteractionFailedException;\nimport botrino.interaction.context.InteractionContext;\nimport botrino.interaction.cooldown.CooldownException;\nimport botrino.interaction.privilege.PrivilegeException;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\n\npublic final class MyErrorHandler implements InteractionErrorHandler {\n\n    @Override\n    public Publisher<?> handleInteractionFailed(InteractionFailedException e, InteractionContext ctx) {\n        return ctx.event().createFollowup("\\uD83D\\uDEAB " + e.getMessage()).withEphemeral(true);\n    }\n\n    @Override\n    public Publisher<?> handlePrivilege(PrivilegeException e, InteractionContext ctx) {\n        return ctx.event().createFollowup("You have insufficient privileges " +\n                "to run this command.").withEphemeral(true);\n    }\n\n    @Override\n    public Publisher<?> handleCooldown(CooldownException e, InteractionContext ctx) {\n        return ctx.event().createFollowup("You are on cooldown. " +\n                "Retry in " + DurationUtils.format(e.getRetryAfter())).withEphemeral(true);\n    }\n\n    @Override\n    public Publisher<?> handleDefault(Throwable t, InteractionContext ctx) {\n        return ctx.event().createFollowup("Something went wrong! Sorry for the inconvenience.")\n                .withEphemeral(true)\n                .onErrorResume(e -> {\n                    t.addSuppressed(e);\n                    return Mono.empty();\n                }).then(Mono.error(t)); // Forward downstream for logging\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The methods of ",(0,o.jsx)(n.code,{children:"InteractionErrorHandler"})," correspond to the most common error types. Each method exposes\nthe ",(0,o.jsx)(n.code,{children:"InteractionContext"})," in which the error happened. None of them are required to be implemented, by default they just\nforward errors downstream which will only log them at ERROR level. Currently there are four of them:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"handleInteractionFailed(InteractionFailedException, InteractionContext)"}),": allows recovering on\na ",(0,o.jsx)(n.code,{children:"InteractionFailedException"}),'. This exception represents a "normal" failure of the command, when the end user is at\nfault. This exception is generally thrown by yourself in your ',(0,o.jsx)(n.code,{children:"run()"})," method and carries a user-friendly message, so\nthe way to handle it will mostly consist of replying to the user with that message."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"handlePrivilege(PrivilegeException, CommandContext)"}),": allows recovering on a ",(0,o.jsx)(n.code,{children:"PrivilegeException"}),". It is thrown when\na user attempts to use a command with insufficient privileges. Typically, handling this exception will consist of\ntelling the user they cannot use the command. More details on privileges can be found\nin ",(0,o.jsx)(n.a,{href:"/docs/interaction-library/privileges",children:"this section"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"handleCooldown(CooldownException, CommandContext)"}),": allows recovering on a ",(0,o.jsx)(n.code,{children:"CooldownException"}),". It is thrown when a\nuser attempts to use a command past the maximum usage limit within a time interval. Generally, it will be handled by\nnotifying the user that they need to wait some time before trying the command again (the exception carries the exact\ntime left). More details on cooldowns can be found in ",(0,o.jsx)(n.a,{href:"/docs/interaction-library/cooldowns",children:"this section"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"handleDefault(Throwable, CommandContext)"}),": allows recovering on an exception type that corresponds to none of the\nabove."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{title:"Considerations when using the Botrino framework",type:"caution",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The implementation class must have a no-arg constructor."}),"\n",(0,o.jsxs)(n.li,{children:["If more than one implementation of ",(0,o.jsx)(n.code,{children:"InteractionErrorHandler"})," are found, it will result in an error as it is impossible\nto determine which one to use. If you don't want to remove the extra implementation(s), you can mark one of them with\nthe ",(0,o.jsx)(n.code,{children:"@Primary"})," annotation to lift the ambiguity. You may alternatively use the ",(0,o.jsx)(n.code,{children:"@Exclude"})," annotation if you don't want\none implementation to be picked up by Botrino."]}),"\n"]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>l});var r=t(6540);const o={},i=r.createContext(o);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);