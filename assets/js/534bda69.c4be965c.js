"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[351],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return d}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),l=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=l(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),u=l(n),d=i,h=u["".concat(s,".").concat(d)]||u[d]||p[d]||a;return n?o.createElement(h,r(r({ref:t},m),{},{components:n})):o.createElement(h,r({ref:t},m))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,r[1]=c;for(var l=2;l<a;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3919:function(e,t,n){function o(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!o(e)}n.d(t,{b:function(){return o},Z:function(){return i}})},4996:function(e,t,n){n.d(t,{C:function(){return a},Z:function(){return r}});var o=n(2263),i=n(3919);function a(){var e=(0,o.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,a=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,o){var a=void 0===o?{}:o,r=a.forcePrependBaseUrl,c=void 0!==r&&r,s=a.absolute,l=void 0!==s&&s;if(!n)return n;if(n.startsWith("#"))return n;if((0,i.b)(n))return n;if(c)return t+n;var m=n.startsWith(t)?n:t+n.replace(/^\//,"");return l?e+m:m}(a,n,e,t)}}}function r(e,t){return void 0===t&&(t={}),(0,a().withBaseUrl)(e,t)}},3100:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m},default:function(){return u}});var o=n(7462),i=n(3366),a=(n(7294),n(3905)),r=n(4996),c=["components"],s={title:"Dealing with components"},l={unversionedId:"interaction-library/dealing-with-components",id:"interaction-library/dealing-with-components",isDocsHomePage:!1,title:"Dealing with components",description:"The library offers two ways to handle interactions with message components (buttons and select menus).",source:"@site/docs/interaction-library/dealing-with-components.md",sourceDirName:"interaction-library",slug:"/interaction-library/dealing-with-components",permalink:"/docs/interaction-library/dealing-with-components",editUrl:"https://github.com/Alex1304/botrino/edit/main/website/docs/interaction-library/dealing-with-components.md",version:"current",frontMatter:{title:"Dealing with components"},sidebar:"someSidebar",previous:{title:"Acknowledging interactions",permalink:"/docs/interaction-library/acknowledging-interactions"},next:{title:"Privileges",permalink:"/docs/interaction-library/privileges"}},m=[{value:"Handling component interactions as regular commands",id:"handling-component-interactions-as-regular-commands",children:[]},{value:"Waiting for component interactions inside a command",id:"waiting-for-component-interactions-inside-a-command",children:[]},{value:"Pagination system with components",id:"pagination-system-with-components",children:[]}],p={toc:m};function u(e){var t=e.components,n=(0,i.Z)(e,c);return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The library offers two ways to handle interactions with message components (buttons and select menus)."),(0,a.kt)("h2",{id:"handling-component-interactions-as-regular-commands"},"Handling component interactions as regular commands"),(0,a.kt)("p",null,"The first way is to treat component interactions as regular commands, which consists of declaring a listener that is going to be called every time a component with a specific ",(0,a.kt)("inlineCode",{parentName:"p"},"customId")," is interacted with. The structure is similar to ",(0,a.kt)("a",{parentName:"p",href:"/docs/interaction-library/creating-commands"},"creating commands"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.ComponentCommand;\nimport botrino.interaction.context.ButtonInteractionContext;\nimport botrino.interaction.listener.ComponentInteractionListener;\nimport org.reactivestreams.Publisher;\n\n@ComponentCommand("clickme")\npublic final class ClickMeButtonCommand implements ComponentInteractionListener<Void> {\n\n    @Override\n    public Publisher<Void> run(ButtonInteractionContext ctx) {\n        return ctx.event().createFollowup("Button clicked!").then();\n    }\n}\n')),(0,a.kt)("p",null,"The class implements ",(0,a.kt)("inlineCode",{parentName:"p"},"ComponentInteractionListener<Void>")," and overrides ",(0,a.kt)("inlineCode",{parentName:"p"},"run(ButtonInteractionContext)")," (it has several ",(0,a.kt)("inlineCode",{parentName:"p"},"run()")," overloads, one for each type of component, here we want a button. For select menus you're supposed to override ",(0,a.kt)("inlineCode",{parentName:"p"},"run(SelectMenuInteractionContext)"),"). The ",(0,a.kt)("inlineCode",{parentName:"p"},"@ComponentCommand")," annotation specifies the customId to listen for. Let's make a chat input command to create the message containing the button:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.ChatInputCommand;\nimport botrino.interaction.context.ChatInputInteractionContext;\nimport botrino.interaction.listener.ChatInputInteractionListener;\nimport discord4j.core.object.component.ActionRow;\nimport discord4j.core.object.component.Button;\nimport org.reactivestreams.Publisher;\n\n@ChatInputCommand(name = "create-button", description = "Create a button.")\npublic final class CreateButtonCommand implements ChatInputInteractionListener {\n\n    @Override\n    public Publisher<?> run(ChatInputInteractionContext ctx) {\n        return ctx.event().createFollowup("Click the button:")\n                .withComponents(ActionRow.of(\n                        Button.primary("clickme", "Click me!")));\n    }\n}\n')),(0,a.kt)("p",null,"As usual, unless you are using the Botrino framework, you need to register them manually:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"interactionService.registerComponentCommand(new ClickMeButtonCommand());\ninteractionService.registerChatInputCommand(new CreateButtonCommand());\n")),(0,a.kt)("p",null,"Result:"),(0,a.kt)("img",{src:(0,r.Z)("img/clickme.png"),alt:""}),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@ComponentCommand")," annotation is in fact not required if you aren't using the Botrino framework. You may as well override the ",(0,a.kt)("inlineCode",{parentName:"p"},"customId()")," method from ",(0,a.kt)("inlineCode",{parentName:"p"},"ComponentInteractionListener"),". The annotation is still required when using the Botrino framework, as it will only auto-register listeners containing that annotation, but if you are already overriding ",(0,a.kt)("inlineCode",{parentName:"p"},"customId()")," you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"@ComponentCommand")," alone without the value. An example might be more clear:"),(0,a.kt)("pre",{parentName:"div"},(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.ComponentCommand;\nimport botrino.interaction.context.ButtonInteractionContext;\nimport botrino.interaction.listener.ComponentInteractionListener;\nimport org.reactivestreams.Publisher;\n\n@ComponentCommand // You may omit the customId here...\npublic final class ClickMeButtonCommand implements ComponentInteractionListener<Void> {\n    \n    @Override\n    public String customId() {\n        return "clickme"; // ...if you specify it here instead\n    }\n\n    @Override\n    public Publisher<Void> run(ButtonInteractionContext ctx) {\n        return ctx.event().createFollowup("Button clicked!").then();\n    }\n}\n')))),(0,a.kt)("h2",{id:"waiting-for-component-interactions-inside-a-command"},"Waiting for component interactions inside a command"),(0,a.kt)("p",null,'In many cases, you want to use components as a way to make your commands more interactive, for example if you need confirmation from the user to perform an action. You would need some way to "pause" the execution of your command and resume when the user has given a response by clicking a button or a select menu. This is made easy with the ',(0,a.kt)("inlineCode",{parentName:"p"},"awaitButtonClick(customId)")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"awaitSelectMenuItems(customId)")," methods. Here's an example of a simple command waiting for the user to select an item and display the value clicked:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.ChatInputCommand;\nimport botrino.interaction.context.ChatInputInteractionContext;\nimport botrino.interaction.listener.ChatInputInteractionListener;\nimport discord4j.core.object.component.ActionRow;\nimport discord4j.core.object.component.SelectMenu;\nimport discord4j.core.object.entity.Message;\nimport discord4j.core.spec.InteractionFollowupCreateSpec;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\n\nimport java.util.UUID;\n\nimport static botrino.interaction.listener.ComponentInteractionListener.selectMenu;\n\n@ChatInputCommand(name = "select", description = "Command for testing select menus")\npublic class SelectCommand implements ChatInputInteractionListener {\n\n    @Override\n    public Publisher<?> run(ChatInputInteractionContext ctx) {\n        final var customId = UUID.randomUUID().toString();\n        return ctx.event().createFollowup("Select an option:")\n                .withComponents(ActionRow.of(SelectMenu.of(customId,\n                        SelectMenu.Option.of("option 1", "foo"),\n                        SelectMenu.Option.of("option 2", "bar"),\n                        SelectMenu.Option.of("option 3", "baz"))))\n                .map(Message::getId)\n                // Wait until the select menu is interacted with and return the value clicked\n                .flatMap(messageId -> ctx.awaitSelectMenuItems(customId)\n                        .flatMap(items -> ctx.event().createFollowup("You clicked: " + items.get(0))\n                                .then(ctx.event().deleteFollowup(messageId))));\n    }\n}\n')),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Since you want to listen for one specific select menu (and not all select menus with some customId), you generate a customId that is unique for each invocation of the ",(0,a.kt)("inlineCode",{parentName:"li"},"/select")," command. You can easily generate a random string via ",(0,a.kt)("inlineCode",{parentName:"li"},"java.util.UUID"),"."),(0,a.kt)("li",{parentName:"ol"},"A first followup is sent with the message containing the select menu."),(0,a.kt)("li",{parentName:"ol"},"Once the message has been sent, call ",(0,a.kt)("inlineCode",{parentName:"li"},"awaitSelectMenuItems(customId)")," with the same customId generated previously. It will wait for the user to interact with the menu and will emit the value clicked."),(0,a.kt)("li",{parentName:"ol"},"The value received is then displayed via a new followup message.")),(0,a.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If you don't make the customId unique on each run, there will be conflicts when the ",(0,a.kt)("inlineCode",{parentName:"p"},"/select")," command is run several times consecutively by the same user in the same channel."))),(0,a.kt)("p",null,"Here is another example with ",(0,a.kt)("inlineCode",{parentName:"p"},"awaitButtonClick(customId)")," that asks the user to confirm when resetting a user's nickname:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.UserCommand;\nimport botrino.interaction.context.UserInteractionContext;\nimport botrino.interaction.listener.UserInteractionListener;\nimport discord4j.core.object.component.ActionRow;\nimport discord4j.core.object.component.Button;\nimport discord4j.core.object.entity.Message;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\n\nimport java.util.UUID;\n\nimport static botrino.interaction.listener.ComponentInteractionListener.button;\n\n@UserCommand("Reset Nickname")\npublic class ResetNickCommand implements UserInteractionListener {\n\n    @Override\n    public Publisher<?> run(UserInteractionContext ctx) {\n        final var guildId = ctx.event().getInteraction().getGuildId().orElse(null);\n        if (guildId == null) {\n            return ctx.event().createFollowup("Cannot use outside of a guild");\n        }\n        final var yesId = UUID.randomUUID().toString();\n        final var noId = UUID.randomUUID().toString();\n        return ctx.event().createFollowup("Reset the nickname of that user?")\n                .withComponents(ActionRow.of(\n                        Button.primary(yesId, "Yes"),\n                        Button.secondary(noId, "No")))\n                .map(Message::getId)\n                .flatMap(messageId -> Mono.firstWithValue(\n                                ctx.awaitButtonClick(yesId),\n                                ctx.awaitButtonClick(noId))\n                        .flatMap(buttonClicked -> buttonClicked.equals(yesId) ? ctx.event()\n                                .getClient()\n                                .getMemberById(guildId, ctx.event().getTargetId())\n                                .flatMap(member -> member.edit().withNicknameOrNull(null))\n                                .then(ctx.event().createFollowup("Nickname reset successful!"))\n                                : ctx.event().createFollowup("Action cancelled"))\n                        .then(ctx.event().deleteFollowup(messageId)));\n    }\n}\n')),(0,a.kt)("p",null,'The code is quite self-explanatory: we display two buttons, one for "yes" and one for "no". We use ',(0,a.kt)("inlineCode",{parentName:"p"},"Mono.firstWithValue")," to only wait for the first click on either of the two buttons, and depending on which button was clicked, we execute one or the other action."),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"There exists a more generic method ",(0,a.kt)("inlineCode",{parentName:"p"},"awaitComponentInteraction")," that lets you manipulate the underlying interaction context before returning a value. It accepts a ",(0,a.kt)("inlineCode",{parentName:"p"},"ComponentInteractionListener<R>")," that you can construct via its static methods ",(0,a.kt)("inlineCode",{parentName:"p"},"button(String, Function)")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"selectMenu(String, Function)"),", each accepting the customId and a function receiving a ",(0,a.kt)("inlineCode",{parentName:"p"},"ButtonInteractionContext")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"SelectMenuInteractionContext")," and producing a value of any type."))),(0,a.kt)("h2",{id:"pagination-system-with-components"},"Pagination system with components"),(0,a.kt)("p",null,"Making a pagination system is one of the most obvious use cases for message components. The library provides a static method ",(0,a.kt)("inlineCode",{parentName:"p"},"MessagePaginator::paginate")," to build paginated messages easily. See the example below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package testbot1;\n\nimport botrino.interaction.annotation.ChatInputCommand;\nimport botrino.interaction.context.ChatInputInteractionContext;\nimport botrino.interaction.listener.ChatInputInteractionListener;\nimport botrino.interaction.util.MessagePaginator;\nimport discord4j.core.object.component.ActionRow;\nimport discord4j.core.object.component.Button;\nimport discord4j.core.spec.MessageCreateSpec;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\n\n@ChatInputCommand(name = "paginate", description = "Pagination testing")\npublic final class PaginateCommand implements ChatInputInteractionListener {\n\n    @Override\n    public Publisher<?> run(ChatInputInteractionContext ctx) {\n        return MessagePaginator.paginate(ctx, 5, state -> Mono.just(MessageCreateSpec.create()\n                .withContent("Page " + (state.getPage() + 1) + "/" + state.getPageCount())\n                .withComponents(ActionRow.of(\n                        state.previousButton(customId -> Button.secondary(customId, "<< Previous")),\n                        state.nextButton(customId -> Button.secondary(customId, "Next >>")),\n                        state.closeButton(customId -> Button.danger(customId, "Close"))\n                ))));\n    }\n}\n')),(0,a.kt)("img",{src:(0,r.Z)("img/paginate.png"),alt:""}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"paginate")," method takes 3 arguments. The first one is the interaction context, the second one is the total number of pages, and the last one is a function that receives a state and produces the message to display. An overload exists allowing you to specify the initial page number (by default it starts at the first page)."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"state")," holds information on the current state of the paginator, such as the current page number and whether it is active"),(0,a.kt)("li",{parentName:"ul"},"To render the buttons, the state exposes three methods to build previous, next and close buttons respectively. The state object controls whether the buttons are enabled or disabled according to whether we are at first page (in which case previous button should be disabled), at last page (in which case next button should be disabled), or if the paginator has already closed, in which case all buttons should be disabled.")),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The paginator automatically closes as per the ",(0,a.kt)("inlineCode",{parentName:"p"},"await_component_timeout_seconds")," value defined in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/interaction-library/configuration"},"configuration"),"."))))}u.isMDXComponent=!0}}]);