"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[937],{3905:function(e,n,o){o.d(n,{Zo:function(){return c},kt:function(){return u}});var t=o(7294);function a(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function r(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function d(e,n){if(null==e)return{};var o,t,a=function(e,n){if(null==e)return{};var o,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=t.createContext({}),l=function(e){var n=t.useContext(s),o=n;return e&&(o="function"==typeof e?e(n):i(i({},n),e)),o},c=function(e){var n=l(e.components);return t.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var o=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=l(o),u=a,h=p["".concat(s,".").concat(u)]||p[u]||m[u]||r;return o?t.createElement(h,i(i({ref:n},c),{},{components:o})):t.createElement(h,i({ref:n},c))}));function u(e,n){var o=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=p;var d={};for(var s in n)hasOwnProperty.call(n,s)&&(d[s]=n[s]);d.originalType=e,d.mdxType="string"==typeof e?e:a,i[1]=d;for(var l=2;l<r;l++)i[l]=o[l];return t.createElement.apply(null,i)}return t.createElement.apply(null,o)}p.displayName="MDXCreateElement"},189:function(e,n,o){o.r(n),o.d(n,{frontMatter:function(){return d},metadata:function(){return s},toc:function(){return l},default:function(){return m}});var t=o(7462),a=o(3366),r=(o(7294),o(3905)),i=["components"],d={title:"Cooldowns"},s={unversionedId:"command-extension/cooldowns",id:"command-extension/cooldowns",isDocsHomePage:!1,title:"Cooldowns",description:"If your commands perform costly operations or can potentially be abused, you may want to set a limit on the number of times the command can be used. The Cooldown API will allow you to deal with these situations without hassle.",source:"@site/docs/command-extension/cooldowns.md",sourceDirName:"command-extension",slug:"/command-extension/cooldowns",permalink:"/docs/command-extension/cooldowns",editUrl:"https://github.com/Alex1304/botrino/edit/main/website/docs/command-extension/cooldowns.md",version:"current",frontMatter:{title:"Cooldowns"},sidebar:"someSidebar",previous:{title:"Privileges",permalink:"/docs/command-extension/privileges"},next:{title:"Handling errors",permalink:"/docs/command-extension/handling-errors"}},l=[{value:"Set a cooldown to a command",id:"set-a-cooldown-to-a-command",children:[]},{value:"Sharing cooldown between commands",id:"sharing-cooldown-between-commands",children:[]},{value:"Handling cooldowns",id:"handling-cooldowns",children:[]}],c={toc:l};function m(e){var n=e.components,o=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,t.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"If your commands perform costly operations or can potentially be abused, you may want to set a limit on the number of times the command can be used. The Cooldown API will allow you to deal with these situations without hassle."),(0,r.kt)("h2",{id:"set-a-cooldown-to-a-command"},"Set a cooldown to a command"),(0,r.kt)("p",null,"Override the ",(0,r.kt)("inlineCode",{parentName:"p"},"cooldown()")," method from ",(0,r.kt)("inlineCode",{parentName:"p"},"Command")," (or use the corresponding method in ",(0,r.kt)("inlineCode",{parentName:"p"},"Command.Builder")," if you build the command inline), and specify the cooldown using ",(0,r.kt)("inlineCode",{parentName:"p"},"Cooldown.of(int, Duration)"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Override\npublic Cooldown cooldown() {\n    return Cooldown.of(1, Duration.ofMinutes(1));\n}\n")),(0,r.kt)("p",null,"The integer represents the maximum number of times the command can be executed within a timeframe, and the duration represents the timeframe itself. Therefore, this example corresponds to a cooldown of ",(0,r.kt)("strong",{parentName:"p"},"once per minute"),"."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Cooldowns are applied ",(0,r.kt)("strong",{parentName:"p"},"per user"),". Two different users using the same command will always have their own separate usage limits."))),(0,r.kt)("h2",{id:"sharing-cooldown-between-commands"},"Sharing cooldown between commands"),(0,r.kt)("p",null,"In some cases, you may want several different commands to share the same cooldown. In order to achieve this, all you need to do is to reuse the same ",(0,r.kt)("inlineCode",{parentName:"p"},"Cooldown")," instance between the commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'var cooldown = Cooldown.of(3, Duration.ofMinutes(2));\ncommandService.addTopLevelCommand(Command.builder("test1",\n            ctx -> ctx.channel().createMessage("test1").then())\n        .setCooldown(cooldown)\n        .build());\ncommandService.addTopLevelCommand(Command.builder("test2",\n            ctx -> ctx.channel().createMessage("test2").then())\n        .setCooldown(cooldown)\n        .build());\ncommandService.addTopLevelCommand(Command.builder("test3",\n            ctx -> ctx.channel().createMessage("test3").then())\n        .setCooldown(cooldown)\n        .build());\n')),(0,r.kt)("p",null,"If you are implementing the command via a class, you can store the ",(0,r.kt)("inlineCode",{parentName:"p"},"Cooldown")," instance in a static field, or wrap it in a service that you inject in each target command class."),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In order to properly share a cooldown from a parent command to a subcommand, it is important to store the instance in a field of the parent command, even if ",(0,r.kt)("inlineCode",{parentName:"p"},"inheritFrom(this)")," is used. For instance, the following code will NOT share the instance to the subcommand:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic Cooldown cooldown() {\n    return Cooldown.of(1, Duration.ofMinutes(1));\n}\n\n@Override\npublic Set<Command> subcommands() {\n    return Set.of(\n        Command.builder("sub",\n                ctx -> ctx.channel()\n                        .createMessage("This is a subcommand!")\n                        .then())\n                .inheritFrom(this)\n                .build()\n    );\n}\n')),(0,r.kt)("p",{parentName:"div"},"Here is how to fix it:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private final Cooldown cooldown = Cooldown.of(1, Duration.ofMinutes(1));\n\n@Override\npublic Cooldown cooldown() {\n    return cooldown;\n}\n\n@Override\npublic Set<Command> subcommands() {\n    return Set.of(\n        Command.builder("sub",\n                ctx -> ctx.channel()\n                        .createMessage("This is a subcommand!")\n                        .then())\n                .inheritFrom(this)\n                .build()\n    );\n}\n')),(0,r.kt)("p",{parentName:"div"},"Notice that the code of ",(0,r.kt)("inlineCode",{parentName:"p"},"subcommands()")," didn't change, but now subsequent invocations of ",(0,r.kt)("inlineCode",{parentName:"p"},"cooldown()")," (which is what ",(0,r.kt)("inlineCode",{parentName:"p"},"inheritFrom(this)")," does behind the scenes) will properly return the same instance."))),(0,r.kt)("h2",{id:"handling-cooldowns"},"Handling cooldowns"),(0,r.kt)("p",null,"When a user reaches the maximum number of permits and attempts to use the command again, the command will fail with a ",(0,r.kt)("inlineCode",{parentName:"p"},"CooldownException"),". You can handle this exception via the command error handler, which will be covered in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/command-extension/handling-errors"},"next section"),"."))}m.isMDXComponent=!0}}]);